var w=Object.defineProperty;var S=(s,e,t)=>e in s?w(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var o=(s,e,t)=>S(s,typeof e!="symbol"?e+"":e,t);import{O as p}from"./Oscilloscope-0AkMdwqr.js";class g{constructor(e,t,n){o(this,"buffer");o(this,"sampleRate");o(this,"position",0);o(this,"chunkSize",4096);o(this,"isLooping",!1);if(t<=0||!isFinite(t))throw new Error("Sample rate must be a positive finite number");if(this.buffer=e,this.sampleRate=t,(n==null?void 0:n.chunkSize)!==void 0){if(n.chunkSize<=0||!isFinite(n.chunkSize)||!Number.isInteger(n.chunkSize))throw new Error("Chunk size must be a positive integer");this.chunkSize=n.chunkSize}(n==null?void 0:n.loop)!==void 0&&(this.isLooping=n.loop)}static fromAudioBuffer(e,t){const n=(t==null?void 0:t.channel)??0;if(n<0||n>=e.numberOfChannels)throw new Error(`Invalid channel index ${n}. AudioBuffer has ${e.numberOfChannels} channel(s).`);const r=e.getChannelData(n);return new g(r,e.sampleRate,{chunkSize:t==null?void 0:t.chunkSize,loop:t==null?void 0:t.loop})}getNextChunk(){if(this.buffer.length===0)return null;if(this.position>=this.buffer.length)if(this.isLooping)this.position=0;else return null;const e=Math.min(this.position+this.chunkSize,this.buffer.length),t=this.buffer.slice(this.position,e);if(t.length<this.chunkSize&&this.isLooping){const n=this.chunkSize-t.length,r=Math.min(n,this.buffer.length),i=new Float32Array(this.chunkSize);return i.set(t,0),i.set(this.buffer.slice(0,r),t.length),this.position=r,i}if(this.position=e,t.length<this.chunkSize){const n=new Float32Array(this.chunkSize);return n.set(t,0),n}return t}reset(){this.position=0}seek(e){this.position=Math.max(0,Math.min(e,this.buffer.length))}getPosition(){return this.position}getLength(){return this.buffer.length}getSampleRate(){return this.sampleRate}setChunkSize(e){if(e<=0||!isFinite(e)||!Number.isInteger(e))throw new Error("Chunk size must be a positive integer");this.chunkSize=e}getChunkSize(){return this.chunkSize}setLooping(e){this.isLooping=e}isLoop(){return this.isLooping}isAtEnd(){return this.position>=this.buffer.length&&!this.isLooping}}const E=document.getElementById("oscilloscope"),u=document.getElementById("startBtn"),d=document.getElementById("stopBtn"),h=document.getElementById("status"),m=document.getElementById("frequency"),b=document.getElementById("gain"),k=document.querySelectorAll('input[name="waveform"]'),a=document.createElement("canvas");a.width=250;a.height=120;const c=new p(E,a,a,a,a);c.setDebugOverlaysEnabled(!1);let l=null;function z(){l=setInterval(()=>{const s=c.getEstimatedFrequency();m.textContent=s>0?`${s.toFixed(1)} Hz`:"--- Hz";const e=c.getCurrentGain();b.textContent=`${e.toFixed(2)}x`},100)}function v(){l&&(clearInterval(l),l=null),m.textContent="--- Hz",b.textContent="---x"}function C(s,e=44100,t=1){const n=new Float32Array(e*t),r=n.length;switch(s){case"440":for(let i=0;i<r;i++)n[i]=Math.sin(2*Math.PI*440*i/e);break;case"880":for(let i=0;i<r;i++)n[i]=Math.sin(2*Math.PI*880*i/e);break;case"220":for(let i=0;i<r;i++)n[i]=Math.sin(2*Math.PI*220*i/e);break;case"complex":for(let i=0;i<r;i++)n[i]=.5*Math.sin(2*Math.PI*440*i/e)+.3*Math.sin(2*Math.PI*880*i/e);break}return n}async function f(){try{u.disabled=!0,h.textContent="初期化中...";const s=document.querySelector('input[name="waveform"]:checked');if(!s)throw new Error("波形が選択されていません");const e=s.value,t=44100,n=C(e,t,1),r=new g(n,t,{loop:!0});await c.startFromBuffer(r),h.textContent="実行中",d.disabled=!1,z(),k.forEach(i=>i.disabled=!0)}catch(s){console.error("Failed to start oscilloscope:",s),h.textContent="エラー",u.disabled=!1}}u.addEventListener("click",f);d.addEventListener("click",async()=>{try{await c.stop(),h.textContent="停止",u.disabled=!1,d.disabled=!0,v(),k.forEach(s=>s.disabled=!1)}catch(s){console.error("Failed to stop oscilloscope:",s)}});document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{console.log("Auto-starting oscilloscope with 440Hz..."),f()}):(console.log("Auto-starting oscilloscope with 440Hz..."),f());
//# sourceMappingURL=demo-B8LH4eBp.js.map
