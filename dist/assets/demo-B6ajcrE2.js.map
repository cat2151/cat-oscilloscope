{"version":3,"file":"demo-B6ajcrE2.js","sources":["../../demo-simple.js"],"sourcesContent":["// CDN経由でライブラリをインポート\n// NOTE:\n//   このデモでは最新版を手軽に試せるよう、jsDelivr の `@main` を利用しています。\n//   本番環境で利用する場合は、CDN キャッシュの不整合を避けるため、必ずバージョンタグ\n//   もしくはコミットハッシュを指定してください（例）:\n//   import { Oscilloscope, BufferSource } from\n//     'https://cdn.jsdelivr.net/gh/cat2151/cat-oscilloscope@v1.0.0/dist/cat-oscilloscope.mjs';\nimport { Oscilloscope, BufferSource } from 'https://cdn.jsdelivr.net/gh/cat2151/cat-oscilloscope@main/dist/cat-oscilloscope.mjs';\n\n// Canvas要素とUI要素を取得\nconst canvas = document.getElementById('oscilloscope');\nconst startBtn = document.getElementById('startBtn');\nconst stopBtn = document.getElementById('stopBtn');\nconst statusElement = document.getElementById('status');\nconst frequencyElement = document.getElementById('frequency');\nconst gainElement = document.getElementById('gain');\nconst waveformRadios = document.querySelectorAll('input[name=\"waveform\"]');\n\n// Oscilloscopeインスタンスを作成（簡易版なので比較パネル用のcanvasは隠しcanvasを使用）\nconst hiddenCanvas = document.createElement('canvas');\nhiddenCanvas.width = 250;\nhiddenCanvas.height = 120;\n\nconst oscilloscope = new Oscilloscope(\n  canvas,\n  hiddenCanvas,  // previousWaveformCanvas\n  hiddenCanvas,  // currentWaveformCanvas\n  hiddenCanvas,  // similarityPlotCanvas\n  hiddenCanvas   // frameBufferCanvas\n);\n\n// デバッグオーバーレイを無効化（シンプルな表示にするため）\noscilloscope.setDebugOverlaysEnabled(false);\n\n// 周波数とゲイン表示の更新\nlet updateInterval = null;\n\nfunction startUpdates() {\n  updateInterval = setInterval(() => {\n    const freq = oscilloscope.getEstimatedFrequency();\n    frequencyElement.textContent = freq > 0 ? `${freq.toFixed(1)} Hz` : '--- Hz';\n    \n    const gain = oscilloscope.getCurrentGain();\n    gainElement.textContent = `${gain.toFixed(2)}x`;\n  }, 100);\n}\n\nfunction stopUpdates() {\n  if (updateInterval) {\n    clearInterval(updateInterval);\n    updateInterval = null;\n  }\n  frequencyElement.textContent = '--- Hz';\n  gainElement.textContent = '---x';\n}\n\n// 波形データを生成する関数\nfunction generateWaveform(type, sampleRate = 44100, duration = 1) {\n  const audioData = new Float32Array(sampleRate * duration);\n  const len = audioData.length;\n  \n  switch(type) {\n    case '440':\n      // 440Hz サイン波\n      for (let i = 0; i < len; i++) {\n        audioData[i] = Math.sin(2 * Math.PI * 440 * i / sampleRate);\n      }\n      break;\n    case '880':\n      // 880Hz サイン波\n      for (let i = 0; i < len; i++) {\n        audioData[i] = Math.sin(2 * Math.PI * 880 * i / sampleRate);\n      }\n      break;\n    case '220':\n      // 220Hz サイン波\n      for (let i = 0; i < len; i++) {\n        audioData[i] = Math.sin(2 * Math.PI * 220 * i / sampleRate);\n      }\n      break;\n    case 'complex':\n      // 複合波形（440Hz + 880Hz）\n      for (let i = 0; i < len; i++) {\n        audioData[i] = 0.5 * Math.sin(2 * Math.PI * 440 * i / sampleRate) +\n                      0.3 * Math.sin(2 * Math.PI * 880 * i / sampleRate);\n      }\n      break;\n  }\n  \n  return audioData;\n}\n\n// 開始ボタン\nstartBtn.addEventListener('click', async () => {\n  try {\n    startBtn.disabled = true;\n    statusElement.textContent = '初期化中...';\n    \n    // 選択された波形タイプを取得\n    const selectedElement = document.querySelector('input[name=\"waveform\"]:checked');\n    if (!selectedElement) {\n      throw new Error('波形が選択されていません');\n    }\n    const selectedWaveform = selectedElement.value;\n    \n    // 波形データを生成\n    const sampleRate = 44100;\n    const audioData = generateWaveform(selectedWaveform, sampleRate, 1);\n    \n    // BufferSourceを作成してループ再生\n    const bufferSource = new BufferSource(audioData, sampleRate, { loop: true });\n    \n    // 可視化を開始\n    await oscilloscope.startFromBuffer(bufferSource);\n    \n    statusElement.textContent = '実行中';\n    stopBtn.disabled = false;\n    startUpdates();\n    \n    // ラジオボタンを無効化（実行中は変更不可）\n    waveformRadios.forEach(radio => radio.disabled = true);\n  } catch (error) {\n    console.error('Failed to start oscilloscope:', error);\n    statusElement.textContent = 'エラー';\n    startBtn.disabled = false;\n  }\n});\n\n// 停止ボタン\nstopBtn.addEventListener('click', async () => {\n  try {\n    await oscilloscope.stop();\n    \n    statusElement.textContent = '停止';\n    startBtn.disabled = false;\n    stopBtn.disabled = true;\n    stopUpdates();\n    \n    // ラジオボタンを有効化\n    waveformRadios.forEach(radio => radio.disabled = false);\n  } catch (error) {\n    console.error('Failed to stop oscilloscope:', error);\n  }\n});\n"],"names":["canvas","startBtn","stopBtn","statusElement","frequencyElement","gainElement","waveformRadios","hiddenCanvas","oscilloscope","Oscilloscope","updateInterval","startUpdates","freq","gain","stopUpdates","generateWaveform","type","sampleRate","duration","audioData","len","i","selectedElement","selectedWaveform","bufferSource","BufferSource","radio","error"],"mappings":"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"}