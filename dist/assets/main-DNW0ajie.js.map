{"version":3,"file":"main-DNW0ajie.js","sources":["../../src/PianoKeyboardRenderer.ts","../../src/DOMElementManager.ts","../../src/DisplayUpdater.ts","../../src/UIEventHandlers.ts","../../src/main.ts"],"sourcesContent":["import { frequencyToNote } from './utils';\n\n/**\n * PianoKeyboardRenderer handles rendering of piano keyboard visualization\n * Displays a piano keyboard for the frequency range 50Hz - 2000Hz\n * Highlights the key corresponding to the fundamental frequency\n */\nexport class PianoKeyboardRenderer {\n  private canvas: HTMLCanvasElement;\n  private ctx: CanvasRenderingContext2D;\n  \n  // 周波数範囲 (50Hz～2000Hz)\n  private readonly MIN_FREQ = 50;\n  private readonly MAX_FREQ = 2000;\n  \n  // ピアノ鍵盤の定数\n  private readonly WHITE_KEY_WIDTH = 20;\n  private readonly WHITE_KEY_HEIGHT = 60;\n  private readonly BLACK_KEY_WIDTH = 12;\n  private readonly BLACK_KEY_HEIGHT = 38;\n  \n  // 色定義\n  private readonly WHITE_KEY_COLOR = '#ffffff';\n  private readonly BLACK_KEY_COLOR = '#000000';\n  private readonly WHITE_KEY_HIGHLIGHT = '#00ff00';\n  private readonly BLACK_KEY_HIGHLIGHT = '#00cc00';\n  private readonly KEY_BORDER = '#333333';\n  \n  // 音名パターン定数（配列アロケーションを避けるため）\n  // 白鍵: C(0), D(2), E(4), F(5), G(7), A(9), B(11)\n  private readonly WHITE_KEY_NOTES = [0, 2, 4, 5, 7, 9, 11];\n  // 黒鍵: C#(1), D#(3), F#(6), G#(8), A#(10)\n  private readonly BLACK_KEY_NOTES = [1, 3, 6, 8, 10];\n  \n  // キャッシュされた鍵盤範囲（コンストラクタで一度だけ計算）\n  private readonly keyboardRange: { startNote: number; endNote: number };\n  \n  // センタリング用のオフセット（コンストラクタで一度だけ計算）\n  private readonly xOffset: number;\n  \n  // 白鍵の総数（コンストラクタで一度だけ計算）\n  private readonly whiteKeyCount: number;\n  \n  constructor(canvas: HTMLCanvasElement) {\n    this.canvas = canvas;\n    const context = canvas.getContext('2d');\n    if (!context) {\n      throw new Error('Could not get 2D context for piano keyboard');\n    }\n    this.ctx = context;\n    \n    // 鍵盤範囲を一度だけ計算してキャッシュ\n    this.keyboardRange = this.calculateKeyboardRange();\n    \n    // 白鍵の数を計算してキャッシュ\n    this.whiteKeyCount = this.countWhiteKeys();\n    \n    // センタリング用のオフセットを計算\n    this.xOffset = this.calculateCenteringOffset();\n  }\n  \n  /**\n   * 周波数から音名情報を取得\n   * utils.tsのfrequencyToNote関数を使用し、内部形式に変換\n   */\n  private frequencyToNoteInfo(frequency: number): { note: number; octave: number; noteInOctave: number } {\n    const noteInfo = frequencyToNote(frequency);\n    \n    if (!noteInfo) {\n      return { note: -1, octave: -1, noteInOctave: -1 };\n    }\n    \n    // noteName (e.g., \"A4\", \"C#3\") から音名とオクターブを抽出\n    const matches = noteInfo.noteName.match(/^([A-G]#?)(\\d+)$/);\n    if (!matches) {\n      return { note: -1, octave: -1, noteInOctave: -1 };\n    }\n    \n    const noteName = matches[1];\n    const octave = parseInt(matches[2], 10);\n    \n    // 音名から noteInOctave (0-11) を計算\n    const noteNames = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];\n    const noteInOctave = noteNames.indexOf(noteName);\n    \n    // noteIndex を計算 (C0 = 0)\n    const note = octave * 12 + noteInOctave;\n    \n    return { note, octave, noteInOctave };\n  }\n  \n  /**\n   * 表示する鍵盤の範囲を計算\n   * MIN_FREQからMAX_FREQまでの範囲をカバーする\n   */\n  private calculateKeyboardRange(): { startNote: number; endNote: number } {\n    const startNoteInfo = this.frequencyToNoteInfo(this.MIN_FREQ);\n    const endNoteInfo = this.frequencyToNoteInfo(this.MAX_FREQ);\n    \n    return {\n      startNote: startNoteInfo.note,\n      endNote: endNoteInfo.note\n    };\n  }\n  \n  /**\n   * 白鍵の数をカウント\n   */\n  private countWhiteKeys(): number {\n    const range = this.keyboardRange;\n    let count = 0;\n    for (let note = range.startNote; note <= range.endNote; note++) {\n      const noteInOctave = ((note % 12) + 12) % 12;\n      if (this.WHITE_KEY_NOTES.includes(noteInOctave)) {\n        count++;\n      }\n    }\n    return count;\n  }\n  \n  /**\n   * 鍵盤をセンタリングするためのX座標オフセットを計算\n   */\n  private calculateCenteringOffset(): number {\n    // 鍵盤全体の幅\n    const totalKeyboardWidth = this.whiteKeyCount * this.WHITE_KEY_WIDTH;\n    \n    // センタリング用のオフセット\n    return (this.canvas.width - totalKeyboardWidth) / 2;\n  }\n  \n  /**\n   * ピアノ鍵盤を描画\n   * @param highlightFrequency - ハイライトする周波数 (0の場合はハイライトなし)\n   */\n  render(highlightFrequency: number): void {\n    // キャンバスをクリア\n    this.ctx.fillStyle = '#1a1a1a';\n    this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\n    \n    const range = this.keyboardRange;\n    \n    // ハイライトする音名を計算\n    const highlightNoteInfo = highlightFrequency > 0 ? this.frequencyToNoteInfo(highlightFrequency) : null;\n    \n    // 白鍵を描画\n    let whiteKeyIndex = 0;\n    for (let note = range.startNote; note <= range.endNote; note++) {\n      const noteInOctave = ((note % 12) + 12) % 12;\n      \n      // 白鍵の場合\n      if (this.WHITE_KEY_NOTES.includes(noteInOctave)) {\n        const x = this.xOffset + whiteKeyIndex * this.WHITE_KEY_WIDTH;\n        const isHighlighted = highlightNoteInfo && highlightNoteInfo.note === note;\n        \n        this.ctx.fillStyle = isHighlighted ? this.WHITE_KEY_HIGHLIGHT : this.WHITE_KEY_COLOR;\n        this.ctx.fillRect(x, 0, this.WHITE_KEY_WIDTH, this.WHITE_KEY_HEIGHT);\n        \n        this.ctx.strokeStyle = this.KEY_BORDER;\n        this.ctx.lineWidth = 1;\n        this.ctx.strokeRect(x, 0, this.WHITE_KEY_WIDTH, this.WHITE_KEY_HEIGHT);\n        \n        whiteKeyIndex++;\n      }\n    }\n    \n    // 黒鍵を描画（白鍵の上に重ねて描画）\n    whiteKeyIndex = 0;\n    for (let note = range.startNote; note <= range.endNote; note++) {\n      const noteInOctave = ((note % 12) + 12) % 12;\n      \n      // 白鍵の位置をカウント\n      if (this.WHITE_KEY_NOTES.includes(noteInOctave)) {\n        whiteKeyIndex++;\n      }\n      \n      // 黒鍵の場合\n      if (this.BLACK_KEY_NOTES.includes(noteInOctave)) {\n        // 黒鍵は直前の白鍵の右端に配置\n        const x = this.xOffset + whiteKeyIndex * this.WHITE_KEY_WIDTH - this.BLACK_KEY_WIDTH / 2;\n        const isHighlighted = highlightNoteInfo && highlightNoteInfo.note === note;\n        \n        this.ctx.fillStyle = isHighlighted ? this.BLACK_KEY_HIGHLIGHT : this.BLACK_KEY_COLOR;\n        this.ctx.fillRect(x, 0, this.BLACK_KEY_WIDTH, this.BLACK_KEY_HEIGHT);\n        \n        this.ctx.strokeStyle = this.KEY_BORDER;\n        this.ctx.lineWidth = 1;\n        this.ctx.strokeRect(x, 0, this.BLACK_KEY_WIDTH, this.BLACK_KEY_HEIGHT);\n      }\n    }\n    \n    // 周波数範囲を表示\n    this.ctx.fillStyle = '#888888';\n    this.ctx.font = '10px monospace';\n    this.ctx.fillText(`${this.MIN_FREQ}Hz`, this.xOffset + 5, this.WHITE_KEY_HEIGHT - 5);\n    \n    // 右端の周波数表示の位置を計算\n    const text = `${this.MAX_FREQ}Hz`;\n    const textWidth = this.ctx.measureText(text).width;\n    const rightEdge = this.xOffset + this.whiteKeyCount * this.WHITE_KEY_WIDTH;\n    this.ctx.fillText(text, rightEdge - textWidth - 5, this.WHITE_KEY_HEIGHT - 5);\n  }\n  \n  /**\n   * キャンバスをクリア\n   */\n  clear(): void {\n    this.ctx.fillStyle = '#1a1a1a';\n    this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\n  }\n}\n","/**\n * DOMElementManager - Responsible for DOM element retrieval and validation\n * \n * This class follows the Single Responsibility Principle by having one clear purpose:\n * retrieving and validating all DOM elements needed by the application.\n */\nexport class DOMElementManager {\n  // Canvas elements\n  readonly canvas: HTMLCanvasElement;\n  readonly previousWaveformCanvas: HTMLCanvasElement;\n  readonly currentWaveformCanvas: HTMLCanvasElement;\n  readonly similarityPlotCanvas: HTMLCanvasElement;\n  readonly frameBufferCanvas: HTMLCanvasElement;\n  readonly cycleSimilarity8divCanvas: HTMLCanvasElement;\n  readonly cycleSimilarity4divCanvas: HTMLCanvasElement;\n  readonly cycleSimilarity2divCanvas: HTMLCanvasElement;\n  readonly pianoKeyboardCanvas: HTMLCanvasElement;\n\n  // Button elements\n  readonly startButton: HTMLButtonElement;\n  readonly loadFileButton: HTMLButtonElement;\n\n  // Input elements\n  readonly fileInput: HTMLInputElement;\n  readonly autoGainCheckbox: HTMLInputElement;\n  readonly noiseGateCheckbox: HTMLInputElement;\n  readonly fftDisplayCheckbox: HTMLInputElement;\n  readonly harmonicAnalysisCheckbox: HTMLInputElement;\n  readonly pauseDrawingCheckbox: HTMLInputElement;\n  readonly phaseMarkerRangeCheckbox: HTMLInputElement;\n  readonly cycleSimilarityDisplayCheckbox: HTMLInputElement;\n  readonly noiseGateThreshold: HTMLInputElement;\n\n  // Select elements\n  readonly frequencyMethod: HTMLSelectElement;\n  readonly bufferSizeMultiplier: HTMLSelectElement;\n  readonly zeroCrossMode: HTMLSelectElement;\n\n  // Display elements\n  readonly cycleSimilarityPanel: HTMLDivElement;\n  readonly thresholdValue: HTMLSpanElement;\n  readonly statusElement: HTMLSpanElement;\n  readonly frequencyValue: HTMLSpanElement;\n  readonly noteValue: HTMLSpanElement;\n  readonly gainValue: HTMLSpanElement;\n  readonly similarityValue: HTMLSpanElement;\n\n  constructor() {\n    // Retrieve canvas elements\n    this.canvas = this.getElement('canvas') as HTMLCanvasElement;\n    this.previousWaveformCanvas = this.getElement('previousWaveformCanvas') as HTMLCanvasElement;\n    this.currentWaveformCanvas = this.getElement('currentWaveformCanvas') as HTMLCanvasElement;\n    this.similarityPlotCanvas = this.getElement('similarityPlotCanvas') as HTMLCanvasElement;\n    this.frameBufferCanvas = this.getElement('frameBufferCanvas') as HTMLCanvasElement;\n    this.cycleSimilarity8divCanvas = this.getElement('cycleSimilarity8divCanvas') as HTMLCanvasElement;\n    this.cycleSimilarity4divCanvas = this.getElement('cycleSimilarity4divCanvas') as HTMLCanvasElement;\n    this.cycleSimilarity2divCanvas = this.getElement('cycleSimilarity2divCanvas') as HTMLCanvasElement;\n    this.pianoKeyboardCanvas = this.getElement('pianoKeyboardCanvas') as HTMLCanvasElement;\n\n    // Retrieve button elements\n    this.startButton = this.getElement('startButton') as HTMLButtonElement;\n    this.loadFileButton = this.getElement('loadFileButton') as HTMLButtonElement;\n\n    // Retrieve input elements\n    this.fileInput = this.getElement('fileInput') as HTMLInputElement;\n    this.autoGainCheckbox = this.getElement('autoGainCheckbox') as HTMLInputElement;\n    this.noiseGateCheckbox = this.getElement('noiseGateCheckbox') as HTMLInputElement;\n    this.fftDisplayCheckbox = this.getElement('fftDisplayCheckbox') as HTMLInputElement;\n    this.harmonicAnalysisCheckbox = this.getElement('harmonicAnalysisCheckbox') as HTMLInputElement;\n    this.pauseDrawingCheckbox = this.getElement('pauseDrawingCheckbox') as HTMLInputElement;\n    this.phaseMarkerRangeCheckbox = this.getElement('phaseMarkerRangeCheckbox') as HTMLInputElement;\n    this.cycleSimilarityDisplayCheckbox = this.getElement('cycleSimilarityDisplayCheckbox') as HTMLInputElement;\n    this.noiseGateThreshold = this.getElement('noiseGateThreshold') as HTMLInputElement;\n\n    // Retrieve select elements\n    this.frequencyMethod = this.getElement('frequencyMethod') as HTMLSelectElement;\n    this.bufferSizeMultiplier = this.getElement('bufferSizeMultiplier') as HTMLSelectElement;\n    this.zeroCrossMode = this.getElement('zeroCrossMode') as HTMLSelectElement;\n\n    // Retrieve display elements\n    this.cycleSimilarityPanel = this.getElement('cycleSimilarityPanel') as HTMLDivElement;\n    this.thresholdValue = this.getElement('thresholdValue') as HTMLSpanElement;\n    this.statusElement = this.getElement('status') as HTMLSpanElement;\n    this.frequencyValue = this.getElement('frequencyValue') as HTMLSpanElement;\n    this.noteValue = this.getElement('noteValue') as HTMLSpanElement;\n    this.gainValue = this.getElement('gainValue') as HTMLSpanElement;\n    this.similarityValue = this.getElement('similarityValue') as HTMLSpanElement;\n\n    // Validate all elements\n    this.validateElements();\n  }\n\n  /**\n   * Get an element by ID and throw if not found\n   */\n  private getElement(id: string): HTMLElement {\n    const element = document.getElementById(id);\n    if (!element) {\n      throw new Error(`Required DOM element not found: ${id}`);\n    }\n    return element;\n  }\n\n  /**\n   * Validate that all elements are present\n   * This method exists for additional type safety and explicit validation\n   */\n  private validateElements(): void {\n    const elements = [\n      { element: this.canvas, name: 'canvas' },\n      { element: this.previousWaveformCanvas, name: 'previousWaveformCanvas' },\n      { element: this.currentWaveformCanvas, name: 'currentWaveformCanvas' },\n      { element: this.similarityPlotCanvas, name: 'similarityPlotCanvas' },\n      { element: this.frameBufferCanvas, name: 'frameBufferCanvas' },\n      { element: this.cycleSimilarity8divCanvas, name: 'cycleSimilarity8divCanvas' },\n      { element: this.cycleSimilarity4divCanvas, name: 'cycleSimilarity4divCanvas' },\n      { element: this.cycleSimilarity2divCanvas, name: 'cycleSimilarity2divCanvas' },\n      { element: this.pianoKeyboardCanvas, name: 'pianoKeyboardCanvas' },\n      { element: this.startButton, name: 'startButton' },\n      { element: this.loadFileButton, name: 'loadFileButton' },\n      { element: this.fileInput, name: 'fileInput' },\n      { element: this.autoGainCheckbox, name: 'autoGainCheckbox' },\n      { element: this.noiseGateCheckbox, name: 'noiseGateCheckbox' },\n      { element: this.fftDisplayCheckbox, name: 'fftDisplayCheckbox' },\n      { element: this.harmonicAnalysisCheckbox, name: 'harmonicAnalysisCheckbox' },\n      { element: this.pauseDrawingCheckbox, name: 'pauseDrawingCheckbox' },\n      { element: this.phaseMarkerRangeCheckbox, name: 'phaseMarkerRangeCheckbox' },\n      { element: this.cycleSimilarityDisplayCheckbox, name: 'cycleSimilarityDisplayCheckbox' },\n      { element: this.noiseGateThreshold, name: 'noiseGateThreshold' },\n      { element: this.thresholdValue, name: 'thresholdValue' },\n      { element: this.cycleSimilarityPanel, name: 'cycleSimilarityPanel' },\n      { element: this.statusElement, name: 'status' },\n      { element: this.frequencyMethod, name: 'frequencyMethod' },\n      { element: this.bufferSizeMultiplier, name: 'bufferSizeMultiplier' },\n      { element: this.zeroCrossMode, name: 'zeroCrossMode' },\n      { element: this.frequencyValue, name: 'frequencyValue' },\n      { element: this.noteValue, name: 'noteValue' },\n      { element: this.gainValue, name: 'gainValue' },\n      { element: this.similarityValue, name: 'similarityValue' },\n    ];\n\n    for (const { element, name } of elements) {\n      if (!element) {\n        throw new Error(`Required DOM element not found: ${name}`);\n      }\n    }\n  }\n}\n","import { Oscilloscope } from './Oscilloscope';\nimport { PianoKeyboardRenderer } from './PianoKeyboardRenderer';\nimport { frequencyToNote } from './utils';\n\n/**\n * DisplayUpdater - Responsible for updating display elements\n * \n * This class follows the Single Responsibility Principle by having one clear purpose:\n * updating the UI display elements (frequency, note, gain, similarity) periodically.\n */\nexport class DisplayUpdater {\n  private oscilloscope: Oscilloscope;\n  private pianoKeyboardRenderer: PianoKeyboardRenderer;\n  private frequencyValue: HTMLSpanElement;\n  private noteValue: HTMLSpanElement;\n  private gainValue: HTMLSpanElement;\n  private similarityValue: HTMLSpanElement;\n  private updateInterval: number | null = null;\n  private readonly UPDATE_INTERVAL_MS = 100; // Update every 100ms (10 Hz)\n\n  constructor(\n    oscilloscope: Oscilloscope,\n    pianoKeyboardRenderer: PianoKeyboardRenderer,\n    frequencyValue: HTMLSpanElement,\n    noteValue: HTMLSpanElement,\n    gainValue: HTMLSpanElement,\n    similarityValue: HTMLSpanElement\n  ) {\n    this.oscilloscope = oscilloscope;\n    this.pianoKeyboardRenderer = pianoKeyboardRenderer;\n    this.frequencyValue = frequencyValue;\n    this.noteValue = noteValue;\n    this.gainValue = gainValue;\n    this.similarityValue = similarityValue;\n  }\n\n  /**\n   * Start periodic display updates\n   */\n  start(): void {\n    if (this.updateInterval === null) {\n      this.updateInterval = window.setInterval(() => {\n        this.update();\n      }, this.UPDATE_INTERVAL_MS);\n    }\n  }\n\n  /**\n   * Stop periodic display updates and clear displays\n   */\n  stop(): void {\n    if (this.updateInterval !== null) {\n      clearInterval(this.updateInterval);\n      this.updateInterval = null;\n      this.clearDisplays();\n    }\n  }\n\n  /**\n   * Update all display elements\n   */\n  private update(): void {\n    this.updateFrequencyDisplay();\n    this.updateGainDisplay();\n    this.updateSimilarityDisplay();\n  }\n\n  /**\n   * Update frequency and note displays\n   */\n  private updateFrequencyDisplay(): void {\n    const frequency = this.oscilloscope.getEstimatedFrequency();\n    if (frequency > 0) {\n      this.frequencyValue.textContent = `${frequency.toFixed(1)} Hz`;\n      \n      // Update note display\n      const noteInfo = frequencyToNote(frequency);\n      if (noteInfo) {\n        const centsSign = noteInfo.cents >= 0 ? '+' : '';\n        this.noteValue.textContent = `${noteInfo.noteName}${centsSign}${noteInfo.cents}cent`;\n      } else {\n        this.noteValue.textContent = '---';\n      }\n      \n      // Update piano keyboard\n      this.pianoKeyboardRenderer.render(frequency);\n    } else {\n      this.frequencyValue.textContent = '--- Hz';\n      this.noteValue.textContent = '---';\n      this.pianoKeyboardRenderer.render(0);\n    }\n  }\n\n  /**\n   * Update gain display\n   */\n  private updateGainDisplay(): void {\n    const gain = this.oscilloscope.getCurrentGain();\n    this.gainValue.textContent = `${gain.toFixed(2)}x`;\n  }\n\n  /**\n   * Update similarity display\n   */\n  private updateSimilarityDisplay(): void {\n    if (this.oscilloscope.isSimilaritySearchActive()) {\n      const similarity = this.oscilloscope.getSimilarityScore();\n      this.similarityValue.textContent = similarity.toFixed(3);\n    } else {\n      this.similarityValue.textContent = '---';\n    }\n  }\n\n  /**\n   * Clear all displays\n   */\n  private clearDisplays(): void {\n    this.frequencyValue.textContent = '--- Hz';\n    this.noteValue.textContent = '---';\n    this.gainValue.textContent = '---x';\n    this.similarityValue.textContent = '---';\n    this.pianoKeyboardRenderer.clear();\n  }\n}\n","import { Oscilloscope } from './Oscilloscope';\nimport { DOMElementManager } from './DOMElementManager';\nimport { DisplayUpdater } from './DisplayUpdater';\nimport { dbToAmplitude } from './utils';\n\n/**\n * UIEventHandlers - Responsible for setting up and handling UI events\n * \n * This class follows the Single Responsibility Principle by having one clear purpose:\n * setting up and managing all UI event handlers.\n */\nexport class UIEventHandlers {\n  private oscilloscope: Oscilloscope;\n  private dom: DOMElementManager;\n  private displayUpdater: DisplayUpdater;\n\n  constructor(\n    oscilloscope: Oscilloscope,\n    dom: DOMElementManager,\n    displayUpdater: DisplayUpdater\n  ) {\n    this.oscilloscope = oscilloscope;\n    this.dom = dom;\n    this.displayUpdater = displayUpdater;\n  }\n\n  /**\n   * Set up all UI event handlers\n   */\n  setupEventHandlers(): void {\n    this.setupCheckboxHandlers();\n    this.setupSliderHandlers();\n    this.setupSelectHandlers();\n    this.setupButtonHandlers();\n    this.setupFileInputHandler();\n  }\n\n  /**\n   * Initialize UI state to match oscilloscope configuration\n   */\n  initializeUIState(): void {\n    // Synchronize checkbox state with oscilloscope\n    this.oscilloscope.setAutoGain(this.dom.autoGainCheckbox.checked);\n    this.oscilloscope.setNoiseGate(this.dom.noiseGateCheckbox.checked);\n    this.oscilloscope.setFFTDisplay(this.dom.fftDisplayCheckbox.checked);\n    this.oscilloscope.setHarmonicAnalysisEnabled(this.dom.harmonicAnalysisCheckbox.checked);\n    this.oscilloscope.setPauseDrawing(this.dom.pauseDrawingCheckbox.checked);\n    this.oscilloscope.setPhaseMarkerRangeEnabled(this.dom.phaseMarkerRangeCheckbox.checked);\n\n    // Synchronize cycle similarity panel display\n    this.updateCycleSimilarityPanelDisplay(this.dom.cycleSimilarityDisplayCheckbox.checked);\n\n    // Synchronize noise gate threshold\n    const initialThreshold = this.sliderValueToThreshold(this.dom.noiseGateThreshold.value);\n    this.oscilloscope.setNoiseGateThreshold(initialThreshold.amplitude);\n    this.dom.thresholdValue.textContent = this.formatThresholdDisplay(initialThreshold.db, initialThreshold.amplitude);\n\n    // Synchronize zero-cross mode\n    const initialZeroCrossMode = this.dom.zeroCrossMode.value;\n    const validModes = ['standard', 'peak-backtrack-history', 'bidirectional-nearest', 'gradient-based', 'adaptive-step', 'hysteresis', 'closest-to-zero'];\n    if (validModes.includes(initialZeroCrossMode)) {\n      this.oscilloscope.setZeroCrossMode(initialZeroCrossMode as any);\n    }\n\n    // Set initial focus to start button (allows starting with space key)\n    this.dom.startButton.focus();\n  }\n\n  /**\n   * Set up checkbox event handlers\n   */\n  private setupCheckboxHandlers(): void {\n    // Auto gain checkbox\n    this.dom.autoGainCheckbox.addEventListener('change', () => {\n      this.oscilloscope.setAutoGain(this.dom.autoGainCheckbox.checked);\n    });\n\n    // Noise gate checkbox\n    this.dom.noiseGateCheckbox.addEventListener('change', () => {\n      this.oscilloscope.setNoiseGate(this.dom.noiseGateCheckbox.checked);\n    });\n\n    // FFT display checkbox\n    this.dom.fftDisplayCheckbox.addEventListener('change', () => {\n      this.oscilloscope.setFFTDisplay(this.dom.fftDisplayCheckbox.checked);\n    });\n\n    // Harmonic analysis checkbox\n    this.dom.harmonicAnalysisCheckbox.addEventListener('change', () => {\n      this.oscilloscope.setHarmonicAnalysisEnabled(this.dom.harmonicAnalysisCheckbox.checked);\n    });\n\n    // Pause drawing checkbox\n    this.dom.pauseDrawingCheckbox.addEventListener('change', () => {\n      this.oscilloscope.setPauseDrawing(this.dom.pauseDrawingCheckbox.checked);\n    });\n\n    // Phase marker range checkbox\n    this.dom.phaseMarkerRangeCheckbox.addEventListener('change', () => {\n      this.oscilloscope.setPhaseMarkerRangeEnabled(this.dom.phaseMarkerRangeCheckbox.checked);\n    });\n\n    // Cycle similarity display checkbox\n    this.dom.cycleSimilarityDisplayCheckbox.addEventListener('change', () => {\n      this.updateCycleSimilarityPanelDisplay(this.dom.cycleSimilarityDisplayCheckbox.checked);\n    });\n  }\n\n  /**\n   * Set up slider event handlers\n   */\n  private setupSliderHandlers(): void {\n    // Noise gate threshold slider\n    this.dom.noiseGateThreshold.addEventListener('input', () => {\n      const threshold = this.sliderValueToThreshold(this.dom.noiseGateThreshold.value);\n      this.oscilloscope.setNoiseGateThreshold(threshold.amplitude);\n      this.dom.thresholdValue.textContent = this.formatThresholdDisplay(threshold.db, threshold.amplitude);\n    });\n  }\n\n  /**\n   * Set up select element event handlers\n   */\n  private setupSelectHandlers(): void {\n    // Frequency estimation method selector\n    this.dom.frequencyMethod.addEventListener('change', () => {\n      const method = this.dom.frequencyMethod.value as 'zero-crossing' | 'autocorrelation' | 'fft' | 'stft' | 'cqt';\n      this.oscilloscope.setFrequencyEstimationMethod(method);\n    });\n\n    // Buffer size multiplier selector\n    this.dom.bufferSizeMultiplier.addEventListener('change', () => {\n      const value = parseInt(this.dom.bufferSizeMultiplier.value, 10);\n      if (value === 1 || value === 4 || value === 16) {\n        this.oscilloscope.setBufferSizeMultiplier(value);\n      } else {\n        console.error('Invalid buffer size multiplier:', value);\n        // Reset to default\n        this.dom.bufferSizeMultiplier.value = '1';\n        this.oscilloscope.setBufferSizeMultiplier(1);\n      }\n    });\n\n    // Zero-cross mode selector\n    this.dom.zeroCrossMode.addEventListener('change', () => {\n      const mode = this.dom.zeroCrossMode.value;\n      const validModes = ['standard', 'peak-backtrack-history', 'bidirectional-nearest', 'gradient-based', 'adaptive-step', 'hysteresis', 'closest-to-zero'];\n      if (validModes.includes(mode)) {\n        this.oscilloscope.setZeroCrossMode(mode as any);\n      } else {\n        console.error('Invalid zero-cross mode:', mode);\n        // Reset to default\n        this.dom.zeroCrossMode.value = 'hysteresis';\n        this.oscilloscope.setZeroCrossMode('hysteresis');\n      }\n    });\n  }\n\n  /**\n   * Set up button event handlers\n   */\n  private setupButtonHandlers(): void {\n    // Start button\n    this.dom.startButton.addEventListener('click', async () => {\n      await this.handleStartStopButton();\n    });\n\n    // Load file button\n    this.dom.loadFileButton.addEventListener('click', () => {\n      this.dom.fileInput.click();\n    });\n  }\n\n  /**\n   * Set up file input event handler\n   */\n  private setupFileInputHandler(): void {\n    this.dom.fileInput.addEventListener('change', async () => {\n      await this.handleFileInput();\n    });\n  }\n\n  /**\n   * Handle start/stop button click\n   */\n  private async handleStartStopButton(): Promise<void> {\n    if (!this.oscilloscope.getIsRunning()) {\n      try {\n        this.dom.startButton.disabled = true;\n        this.dom.loadFileButton.disabled = true;\n        this.dom.statusElement.textContent = 'Requesting microphone access...';\n        \n        await this.oscilloscope.start();\n        \n        this.dom.startButton.textContent = 'Stop';\n        this.dom.startButton.disabled = false;\n        this.dom.statusElement.textContent = 'Running - Microphone active';\n        this.displayUpdater.start();\n      } catch (error) {\n        console.error('Failed to start oscilloscope:', error);\n        this.dom.statusElement.textContent = 'Error: Could not access microphone';\n        this.dom.startButton.disabled = false;\n        this.dom.loadFileButton.disabled = false;\n      }\n    } else {\n      try {\n        this.displayUpdater.stop();\n        await this.oscilloscope.stop();\n        this.dom.startButton.textContent = 'Start';\n        this.dom.loadFileButton.disabled = false;\n        this.dom.statusElement.textContent = 'Stopped';\n      } catch (error) {\n        console.error('Failed to stop oscilloscope:', error);\n        this.dom.statusElement.textContent = 'Stopped (with errors)';\n        this.dom.startButton.textContent = 'Start';\n        this.dom.loadFileButton.disabled = false;\n      }\n    }\n  }\n\n  /**\n   * Handle file input change\n   */\n  private async handleFileInput(): Promise<void> {\n    const file = this.dom.fileInput.files?.[0];\n    if (!file) {\n      return;\n    }\n    \n    // Stop if already running\n    if (this.oscilloscope.getIsRunning()) {\n      this.displayUpdater.stop();\n      await this.oscilloscope.stop();\n    }\n    \n    try {\n      this.dom.startButton.disabled = true;\n      this.dom.loadFileButton.disabled = true;\n      this.dom.statusElement.textContent = `Loading file: ${file.name}...`;\n      \n      await this.oscilloscope.startFromFile(file);\n      \n      this.dom.startButton.textContent = 'Stop';\n      this.dom.startButton.disabled = false;\n      this.dom.statusElement.textContent = `Playing: ${file.name} (loop)`;\n      this.displayUpdater.start();\n    } catch (error) {\n      console.error('Failed to load audio file:', error);\n      this.dom.statusElement.textContent = 'Error: Could not load audio file';\n      this.dom.startButton.textContent = 'Start';\n      this.dom.startButton.disabled = false;\n      this.dom.loadFileButton.disabled = false;\n    }\n    \n    // Clear file input to allow loading the same file again\n    this.dom.fileInput.value = '';\n  }\n\n  /**\n   * Convert slider value (-60 to 0) to threshold amplitude (0.001-1.00)\n   * Returns both dB and amplitude to avoid redundant parsing\n   */\n  private sliderValueToThreshold(sliderValue: string): { db: number; amplitude: number } {\n    const db = parseFloat(sliderValue);\n    \n    if (Number.isNaN(db)) {\n      throw new Error(`Invalid slider value for noise gate threshold: \"${sliderValue}\"`);\n    }\n    \n    return { db, amplitude: dbToAmplitude(db) };\n  }\n\n  /**\n   * Format threshold display text\n   */\n  private formatThresholdDisplay(db: number, amplitude: number): string {\n    return `${db.toFixed(0)} dB (${amplitude.toFixed(3)})`;\n  }\n\n  /**\n   * Update cycle similarity panel display\n   */\n  private updateCycleSimilarityPanelDisplay(visible: boolean): void {\n    this.dom.cycleSimilarityPanel.style.display = visible ? 'flex' : 'none';\n  }\n}\n","import { Oscilloscope } from './Oscilloscope';\nimport { PianoKeyboardRenderer } from './PianoKeyboardRenderer';\nimport { DOMElementManager } from './DOMElementManager';\nimport { DisplayUpdater } from './DisplayUpdater';\nimport { UIEventHandlers } from './UIEventHandlers';\n\n/**\n * Main application entry point\n * \n * This module has been refactored to follow the Single Responsibility Principle (SRP).\n * Responsibilities are now clearly separated into specialized classes:\n * - DOMElementManager: DOM element retrieval and validation\n * - DisplayUpdater: Periodic display updates (frequency, note, gain, similarity)\n * - UIEventHandlers: UI event handling and state synchronization\n * \n * This refactoring reduces complexity and makes the codebase easier for AI agents\n * to understand, thereby reducing hallucinations (incorrect assumptions).\n */\n\n// Retrieve and validate all DOM elements\nconst dom = new DOMElementManager();\n\n// Initialize oscilloscope with canvas elements\nconst oscilloscope = new Oscilloscope(\n  dom.canvas,\n  dom.previousWaveformCanvas,\n  dom.currentWaveformCanvas,\n  dom.similarityPlotCanvas,\n  dom.frameBufferCanvas,\n  dom.cycleSimilarity8divCanvas,\n  dom.cycleSimilarity4divCanvas,\n  dom.cycleSimilarity2divCanvas\n);\n\n// Initialize piano keyboard renderer\nconst pianoKeyboardRenderer = new PianoKeyboardRenderer(dom.pianoKeyboardCanvas);\npianoKeyboardRenderer.render(0); // Render empty keyboard initially\n\n// Initialize display updater\nconst displayUpdater = new DisplayUpdater(\n  oscilloscope,\n  pianoKeyboardRenderer,\n  dom.frequencyValue,\n  dom.noteValue,\n  dom.gainValue,\n  dom.similarityValue\n);\n\n// Initialize UI event handlers\nconst eventHandlers = new UIEventHandlers(oscilloscope, dom, displayUpdater);\neventHandlers.initializeUIState();\neventHandlers.setupEventHandlers();\n"],"names":["PianoKeyboardRenderer","canvas","__publicField","context","frequency","noteInfo","frequencyToNote","matches","noteName","octave","noteInOctave","startNoteInfo","endNoteInfo","range","count","note","totalKeyboardWidth","highlightFrequency","highlightNoteInfo","whiteKeyIndex","x","isHighlighted","text","textWidth","rightEdge","DOMElementManager","id","element","elements","name","DisplayUpdater","oscilloscope","pianoKeyboardRenderer","frequencyValue","noteValue","gainValue","similarityValue","centsSign","gain","similarity","UIEventHandlers","dom","displayUpdater","initialThreshold","initialZeroCrossMode","threshold","method","value","mode","error","file","_a","sliderValue","db","dbToAmplitude","amplitude","visible","Oscilloscope","eventHandlers"],"mappings":"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"}