# cat-oscilloscope

A browser-based, oscilloscope-style waveform visualizer.

## üåê Live Demo

**[https://cat2151.github.io/cat-oscilloscope/](https://cat2151.github.io/cat-oscilloscope/)**

You can try the application at the URL above. Microphone access permission is required.

## üìö Usage as a Library

cat-oscilloscope can be used as an npm library in your own projects. For detailed instructions, please refer to [LIBRARY_USAGE.md](./LIBRARY_USAGE.md).

```typescript
import { Oscilloscope } from 'cat-oscilloscope';

const canvas = document.getElementById('canvas') as HTMLCanvasElement;
const oscilloscope = new Oscilloscope(canvas);
await oscilloscope.start();
```

*This document is a placeholder and was largely generated by an LLM. It will be revised in the future.*

## Notes

- Frequency Estimation
  - Sometimes FFT is accurate, and sometimes non-FFT methods are more accurate.
  - Whether to make FFT the default is under consideration.
  - Further improvements to frequency estimation are deferred for now. We will prioritize many other urgent tasks.

## Features

- üé§ **Microphone Input** - Captures audio from the microphone in real-time
- üéØ **Zero-Crossing Detection** - Automatically detects points where the audio crosses from negative to positive
- üìä **Stable Display** - Aligns waveform display based on zero-crossing points for a stable view
- üîä **Auto Gain** - Automatically adjusts waveform amplitude to optimally utilize canvas height
- ‚ö° **Real-time Rendering** - Continuously updates waveform visualization
- üé® **Classic Design** - Green waveform and grid overlay on a black background
- üõ°Ô∏è **Error Handling** - Gracefully handles microphone access permission issues

## Getting Started

### Prerequisites

- Node.js (v16 or higher recommended)
- npm or yarn

### Installation

```bash
npm install
```

### Development

Start the development server:

```bash
npm run dev
```

Open `http://localhost:3000/` in your browser.

### Build

Build for production:

```bash
npm run build
```

The built files will be output to the `dist` directory.

### Preview Production Build

```bash
npm run preview
```

### Testing

Run tests:

```bash
npm test
```

Generate coverage report:

```bash
npm run test:coverage
```

Launch test UI:

```bash
npm run test:ui
```

For more details, refer to [TESTING.md](TESTING.md).

## How It Works

### Zero-Crossing Detection Algorithm

This oscilloscope implements the following zero-crossing detection algorithm:

1.  Scans the audio buffer to detect points where the waveform crosses from negative (or zero) to positive
2.  Identifies the first zero-crossing point
3.  Locates the next zero-crossing point to determine one full waveform cycle
4.  Displays the waveform with a slight padding before and after the zero-crossing points

This results in a stable, non-scrolling display.

### Technical Details

-   **FFT Size**: 4096 samples for high resolution
-   **Smoothing**: Disabled (0) for accurate waveform representation
-   **Display Padding**: 20 samples before and after zero-crossing points
-   **Auto Gain**:
    -   Automatically adjusts to target 80% of canvas height
    -   Smooth transitions via peak tracking (decay rate: 0.95)
    -   Gain range: 0.5x to 99x
    -   Interpolation factor: 0.1 (gradual adjustment)
    -   Toggleable via UI checkbox (default: enabled)
-   **Canvas Resolution**: 800x400 pixels
-   **Refresh Rate**: Synchronized with browser's requestAnimationFrame (approx. 60 FPS)

## Tech Stack

-   **TypeScript** - Type-safe JavaScript
-   **Vite** - Fast build tool and development server
-   **Web Audio API** - Audio capture and analysis
-   **HTML Canvas** - 2D waveform rendering

## Browser Requirements

This application requires:
-   A modern browser supporting the Web Audio API (Chrome, Firefox, Safari, Edge)
-   User permission for microphone access
-   HTTPS or localhost (required for microphone access)

## License

MIT License - See the [LICENSE](LICENSE) file for details

*Big Brother is listening to you. Now the cat does.* üê±